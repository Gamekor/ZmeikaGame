<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Змейка</title>
  <style>
    body { display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background: #000; }
    canvas { background: #111; display: block; }
  </style>
</head>
<body>
  <canvas id="game" width="400" height="400"></canvas>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const grid = 20;
    let snake = [{ x: 160, y: 160 }];
    let direction = { x: grid, y: 0 };
    let apple = { x: 320, y: 320 };
    let score = 0;

    // Для свайпов
    let touchStartX = 0, touchStartY = 0, touchEndX = 0, touchEndY = 0;

    function update() {
      const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };
      snake.unshift(head);

      if (head.x === apple.x && head.y === apple.y) {
        apple.x = Math.floor((Math.random() * canvas.width) / grid) * grid;
        apple.y = Math.floor((Math.random() * canvas.height) / grid) * grid;
        score++;
      } else {
        snake.pop();
      }

      if (head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height || snake.slice(1).some(part => part.x === head.x && part.y === head.y)) {
        alert(`Game Over! Score: ${score}`);
        snake = [{ x: 160, y: 160 }];
        direction = { x: grid, y: 0 };
        score = 0;
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      snake.forEach((part, index) => {
        ctx.fillStyle = index === 0 ? "lime" : "green";
        ctx.fillRect(part.x, part.y, grid, grid);
      });

      ctx.fillStyle = "red";
      ctx.fillRect(apple.x, apple.y, grid, grid);
    }

    function loop() {
      update();
      draw();
      setTimeout(loop, 150); // Скорость змейки
    }

    // Управление стрелками
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowUp" && direction.y === 0) direction = { x: 0, y: -grid };
      if (e.key === "ArrowDown" && direction.y === 0) direction = { x: 0, y: grid };
      if (e.key === "ArrowLeft" && direction.x === 0) direction = { x: -grid, y: 0 };
      if (e.key === "ArrowRight" && direction.x === 0) direction = { x: grid, y: 0 };
    });

    // Управление свайпами
    canvas.addEventListener("touchstart", (e) => {
      const touch = e.touches[0];
      touchStartX = touch.clientX;
      touchStartY = touch.clientY;
    });

    canvas.addEventListener("touchend", (e) => {
      const touch = e.changedTouches[0];
      touchEndX = touch.clientX;
      touchEndY = touch.clientY;

      const diffX = touchEndX - touchStartX;
      const diffY = touchEndY - touchStartY;

      if (Math.abs(diffX) > Math.abs(diffY)) {
        // Горизонтальное движение
        if (diffX > 0 && direction.x === 0) direction = { x: grid, y: 0 }; // Свайп вправо
        else if (diffX < 0 && direction.x === 0) direction = { x: -grid, y: 0 }; // Свайп влево
      } else {
        // Вертикальное движение
        if (diffY > 0 && direction.y === 0) direction = { x: 0, y: grid }; // Свайп вниз
        else if (diffY < 0 && direction.y === 0) direction = { x: 0, y: -grid }; // Свайп вверх
      }
    });

    loop();
  </script>
</body>
</html>
